%----------------------------------------
% OUTER THEME CONFIGURATION
%----------------------------------------
\useoutertheme{infolines}
\setcounter{tocdepth}{1} % Set navigation depth: 1 = sections only
\useoutertheme[width=.05\paperwidth]{sidebar}
\setbeamertemplate{navigation symbols}{}
\setlength{\beamer@headheight}{0.01\paperheight}

% Sidebar appearance
\setbeamertemplate{sidebar left}{%
  \vskip20pt
  \insertverticalnavigation{\beamer@sidebarwidth}%
}

%----------------------------------------
% COLOR DEFINITIONS (UH and Houston Branding)
%----------------------------------------
\definecolor{houstonred}{RGB}{200,16,46}
\definecolor{houstonbrick}{RGB}{150,12,34}
\definecolor{houstonblue}{RGB}{65,143,22}     % Houston Oilers Blue
\definecolor{houstongold}{RGB}{246,190,0}
\definecolor{houstoncream}{RGB}{255,249,217}

\usecolortheme[named=houstonred]{structure}
\setbeamercolor{shorttitle in foot}{fg=houstonred}
\setbeamercolor{frametitle in header}{fg=houstonred}

%----------------------------------------
% LENGTH DEFINITIONS
%----------------------------------------
\newlength{\sidebarwidth}
\setlength{\sidebarwidth}{0.05\paperwidth}

\newlength{\textmargin}
\setlength{\textmargin}{10mm}
\setbeamersize{text margin left=\textmargin, text margin right=\textmargin}

\newlength{\titlehmargin}
\setlength{\titlehmargin}{5mm}

\newlength{\titlevmargin}
\setlength{\titlevmargin}{1mm}

\newlength{\ruleheight}
\setlength{\ruleheight}{0.1pt}

% Total width for title/footer lines
\newlength{\fullpagewidth}
\setlength{\fullpagewidth}{\dimexpr\paperwidth - \sidebarwidth\relax}

% Paragraph layout
\setlength{\parskip}{0pt}
\setlength{\parindent}{0pt}

%----------------------------------------
% LOGO SIZING (Maintain Aspect Ratios)
%----------------------------------------
\newlength{\houstonlogowidth}
\setlength{\houstonlogowidth}{\dimexpr 10mm * 214 / 311 \relax}

\newlength{\mathslogowidth}
\setlength{\mathslogowidth}{\dimexpr 3mm * 347 / 105 \relax}


%----------------------------------------
% Define total page height and width
%----------------------------------------
\newlength{\usablewidth}
\setlength{\usablewidth}{\dimexpr \paperwidth - \sidebarwidth - 2\textmargin - \houstonlogowidth \relax}

\newlength{\headerheight}
\setlength{\headerheight}{25mm} % as you've defined

\newlength{\footerheight}
\setlength{\footerheight}{25cm} % estimate or customize based on your footline

\newlength{\usableheight}
\setlength{\usableheight}{\dimexpr \paperheight - \headerheight - \footheight \relax}


%----------------------------------------
% TITLE SLIDE (Background + Info)
%----------------------------------------
\setbeamertemplate{title page}{
  \begin{picture}(0,0)
    \put(-1.95cm, \dimexpr -\paperheight*6/10 \relax){
      \includegraphics[width=\paperwidth]{title-slide-background.jpg}
    }
    \put(-\textmargin +7mm, -140pt){
      \begin{minipage}[b][4.5cm][t]{0.9\textwidth}
        \raggedright
        \color{white}
        \usebeamerfont{title}
        {\inserttitle\\[0.9cm]}
        \usebeamerfont{subtitle}
        {\insertauthor\\[0.1cm]}
        {\insertinstitute\\[0.3cm]}
        {\insertdate}
      \end{minipage}
    }
  \end{picture}
}

%----------------------------------------
% GENERAL FRAME TITLE HEADER
%----------------------------------------
\setbeamertemplate{frametitle}{%
  \rlap{%
    \begin{beamercolorbox}[sep=0.5\titlevmargin,left,wd=\dimexpr\fullpagewidth - 2\titlehmargin + 2\titlevmargin\relax]{frametitle}%
      \begin{minipage}{\dimexpr\fullpagewidth - \houstonlogowidth - 3\titlehmargin - 0.1cm\relax}%
        \strut{\large\color{houstonred}\insertframetitle}\strut\par
      \end{minipage}%
      \hspace{\titlehmargin}%
      \begin{minipage}{\dimexpr\houstonlogowidth \relax}
        \hfill \hspace*{2mm}
        \includegraphics[width=\houstonlogowidth]{houston-logo.png}%
      \end{minipage}%
    \end{beamercolorbox}%
  }%
  \vspace{\dimexpr-\baselineskip+0.5ex\relax}%
  \noindent\hspace*{\dimexpr -\titlehmargin\relax}%
    \textcolor{gray}{%
    \rule{\dimexpr\paperwidth - \houstonlogowidth - 4\titlehmargin\relax}{\ruleheight}
  }
}

%----------------------------------------
% GENERAL FOOTLINE
%----------------------------------------
\setbeamertemplate{footline}{%
  \noindent\hspace*{\dimexpr\sidebarwidth + \titlehmargin\relax}%
  \textcolor{gray}{%
  \rule{\dimexpr\paperwidth - \houstonlogowidth - 4\titlehmargin\relax}{\ruleheight}
  }\par%
  \vspace{0.5\titlevmargin}%
  \leavevmode%
  \noindent\hspace*{\dimexpr\sidebarwidth + \titlehmargin - \titlevmargin\relax}%
  \begin{beamercolorbox}[sep=\titlevmargin,wd=\dimexpr\paperwidth - \sidebarwidth - 2\titlehmargin + 2\titlevmargin\relax]{footline}%
    \begin{minipage}{\dimexpr\mathslogowidth + 1pt\relax}%
      \includegraphics[width=1.5\mathslogowidth]{pharmacy-logo.png}%
    \end{minipage}%
    \hfill%
    {\usebeamercolor[fg]{shorttitle in foot}\usebeamerfont{title in head/foot}\insertshorttitle}%
    \hfill%
    {\usebeamercolor[fg]{date in head/foot}\usebeamerfont{date in head/foot}\insertshortdate{}}%
    \hfill%
    {\usebeamercolor[houstonred]{page number in head/foot}\usebeamerfont{page number in head/foot}\usebeamertemplate{page number in head/foot}}%
  \end{beamercolorbox}
  \vspace{0.5\titlevmargin}%
}

% --- Objectives frame support -----------------------------------------------

% 1) Requirements
\RequirePackage{xcolor}   % \textcolor
\RequirePackage{etoolbox} % \ifboolexpr, \ifdefempty
\RequirePackage{pgfkeys}  % key–value interface

% 2) Defaults (safe if user forgets to override)
\providecommand{\ObjOneColor}{lightgray}
\providecommand{\ObjTwoColor}{lightgray}
\providecommand{\ObjThreeColor}{lightgray}

\providecommand{\ChapOneColor}{lightgray}
\providecommand{\ChapTwoColor}{lightgray}
\providecommand{\ChapThreeColor}{lightgray}
\providecommand{\ChapFourColor}{lightgray}
\providecommand{\ChapFiveColor}{lightgray}

% 3) Location of the frame file (override earlier in the preamble if desired)
\providecommand{\ObjectivesFrameFile}{presentation/frame_objectives} % no .tex

% 4) Minimal wrapper (3-arg) — keeps backward compatibility
%    Usage: \ObjectivesFrame{Obj1}{Obj2}{Obj3}
\providecommand{\ObjectivesFrame}[3]{%
  \begingroup
    \renewcommand{\ObjOneColor}{#1}%
    \renewcommand{\ObjTwoColor}{#2}%
    \renewcommand{\ObjThreeColor}{#3}%
    \InputIfFileExists{\ObjectivesFrameFile}{}{%
      \PackageWarning{beamerthemeuhcop}{File \ObjectivesFrameFile.tex not found}%
    }%
  \endgroup
}

% 4b) Extended wrapper (8-arg) — includes chapters 1–5
%     Usage: \ObjectivesFrameWithChaps{Obj1}{Obj2}{Obj3}{Chap1}{Chap2}{Chap3}{Chap4}{Chap5}
\newcommand{\ObjectivesFrameWithChaps}[8]{%
  \begingroup
    % Objective colors
    \renewcommand{\ObjOneColor}{#1}%
    \renewcommand{\ObjTwoColor}{#2}%
    \renewcommand{\ObjThreeColor}{#3}%
    % Chapter colors
    \renewcommand{\ChapOneColor}{#4}%
    \renewcommand{\ChapTwoColor}{#5}%
    \renewcommand{\ChapThreeColor}{#6}%
    \renewcommand{\ChapFourColor}{#7}%
    \renewcommand{\ChapFiveColor}{#8}%
    \InputIfFileExists{\ObjectivesFrameFile}{}{%
      \PackageWarning{beamerthemeuhcop}{File \ObjectivesFrameFile.tex not found}%
    }%
  \endgroup
}

% 5) Convenience: highlight ONE objective by index (1/2/3); others -> lightgray
%    Usage: \ObjectivesFrameHighlight{<1|2|3>}
\newcommand{\ObjectivesFrameHighlight}[1]{%
  \begingroup
    \def\ObjA{lightgray}\def\ObjB{lightgray}\def\ObjC{lightgray}%
    \def\idx{#1}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{1}} }{\def\ObjA{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{2}} }{\def\ObjB{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{3}} }{\def\ObjC{black}}{}%
    \renewcommand{\ObjOneColor}{\ObjA}%
    \renewcommand{\ObjTwoColor}{\ObjB}%
    \renewcommand{\ObjThreeColor}{\ObjC}%
    \InputIfFileExists{\ObjectivesFrameFile}{}{%
      \PackageWarning{beamerthemeuhcop}{File \ObjectivesFrameFile.tex not found}%
    }%
  \endgroup
}

% 5b) Convenience: highlight ONE chapter by index (1..5); others -> lightgray
%     Usage: \ObjectivesFrameHighlightChap{<1..5>}
\newcommand{\ObjectivesFrameHighlightChap}[1]{%
  \begingroup
    \def\COne{lightgray}\def\CTwo{lightgray}\def\CThree{lightgray}\def\CFour{lightgray}\def\CFive{lightgray}%
    \def\idx{#1}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{1}} }{\def\COne{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{2}} }{\def\CTwo{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{3}} }{\def\CThree{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{4}} }{\def\CFour{black}}{}%
    \ifboolexpr{ test{\ifnumcomp{\idx}{=}{5}} }{\def\CFive{black}}{}%
    \renewcommand{\ChapOneColor}{\COne}%
    \renewcommand{\ChapTwoColor}{\CTwo}%
    \renewcommand{\ChapThreeColor}{\CThree}%
    \renewcommand{\ChapFourColor}{\CFour}%
    \renewcommand{\ChapFiveColor}{\CFive}%
    \InputIfFileExists{\ObjectivesFrameFile}{}{%
      \PackageWarning{beamerthemeuhcop}{File \ObjectivesFrameFile.tex not found}%
    }%
  \endgroup
}

% 6) Key–value interface (objectives + chapters)
%    Example:
%    \ObjectivesFrameKV[
%       ObjOne=black, ObjTwo=lightgray, ObjThree=lightgray,
%       ChapTwo=black
%    ]
\pgfkeys{
  /uhcop/.is family, /uhcop,
  ObjOne/.estore  in=\uhcop@ObjOne,
  ObjTwo/.estore  in=\uhcop@ObjTwo,
  ObjThree/.estore in=\uhcop@ObjThree,
  ChapOne/.estore in=\uhcop@ChapOne,
  ChapTwo/.estore in=\uhcop@ChapTwo,
  ChapThree/.estore in=\uhcop@ChapThree,
  ChapFour/.estore in=\uhcop@ChapFour,
  ChapFive/.estore in=\uhcop@ChapFive,
}
\newcommand{\ObjectivesFrameKV}[1][]{%
  \begingroup
    % defaults
    \def\uhcop@ObjOne{lightgray}%
    \def\uhcop@ObjTwo{lightgray}%
    \def\uhcop@ObjThree{lightgray}%
    \def\uhcop@ChapOne{lightgray}%
    \def\uhcop@ChapTwo{lightgray}%
    \def\uhcop@ChapThree{lightgray}%
    \def\uhcop@ChapFour{lightgray}%
    \def\uhcop@ChapFive{lightgray}%
    % parse user keys
    \pgfkeys{/uhcop, #1}%
    % apply
    \renewcommand{\ObjOneColor}{\uhcop@ObjOne}%
    \renewcommand{\ObjTwoColor}{\uhcop@ObjTwo}%
    \renewcommand{\ObjThreeColor}{\uhcop@ObjThree}%
    \renewcommand{\ChapOneColor}{\uhcop@ChapOne}%
    \renewcommand{\ChapTwoColor}{\uhcop@ChapTwo}%
    \renewcommand{\ChapThreeColor}{\uhcop@ChapThree}%
    \renewcommand{\ChapFourColor}{\uhcop@ChapFour}%
    \renewcommand{\ChapFiveColor}{\uhcop@ChapFive}%
    \InputIfFileExists{\ObjectivesFrameFile}{}{%
      \PackageWarning{beamerthemeuhcop}{File \ObjectivesFrameFile.tex not found}%
    }%
  \endgroup
}
